---
title: 定制你的GDB
date: 2020-09-09 22:34:11
updte: 2020-09-09 22:34:11
categories:
- tools
tags:
- gdb
- shell
---
经常用 GDB 定位问题吗同学？是否感觉高频操作又臭又长烦的一匹？那么来定制你的 GDB 吧。调教过的 GDB 更趁手哦。
<!--more-->

我们的定制主要依赖 GDB 的两个机制：
1. GDB 可以自定义命令
2. GDB 可以执行传入的参数

define 定义命令，用法：
```
define 命令名
    if $arg0 == 1
	print $arg1 + $arg2
    end
end
```
基本上就是 define-end 定义一个命令，形如`$arg0, $arg1, $arg2, $arg3`调用参数，参数个数理论上没有限制。

直接在 GDB 的交互界面输入就能生效，但是临时的，下次再启动 GDB 就没了。GDB 也支持把自定义命令写入一个文件，然后在 GDB 中 source 一下这个文件就行了。

但是我们每次都敲 source 当然也不能忍嘛。这里就要用到我们上面提到的第二点了。
```
gdb -ex "source gdb.conf"
```
GDB 会去执行 -ex 指定的命令。我们可以把这一行命令 `alias` 为 gdb 写入 shell 的配置文件。

-----------
等等你以为这就结束了吗。

其实如果只是为了给 GDB 添加自定义命令，直接在用户主目录下新建一个`.gdbinit`文件，在这个文件里定义命令，gdb启动就会自动添加这些命令啦。

我之所以弄这么啰嗦是因为，工作几年总归会打磨出一套自己的 dotfile 集包括各种工具大大小小的配置文件。有了这个配置包后，一个很自然的想法是希望这个文件夹能快速部署和快速清理，所以我更愿意把东西放到配置文件夹内而不是被工具限制。

最后，照我个人经验其实大部分问题定位所需的 GDB 操作都是一个固定的模式，我们大可以借助 GDB 的执行命令的特性（-ex 执行命令，-x 执行文件），攒出一个自己的 GDB 三板斧脚本。然后琐碎的小问题直接乱拳打倒，喝杯咖啡他不香吗。 


